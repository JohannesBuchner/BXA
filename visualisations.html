<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Visualisations &#8212; BXA (Bayesian X-ray Analysis) 5.1.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=2c218288"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Inference engine" href="engine.html" />
    <link rel="prev" title="bxa.xspec package" href="bxa.xspec.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  
    <link rel="canonical" href="https://johannesbuchner.github.io/BXA/visualisations.html" />
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="visualisations">
<h1>Visualisations<a class="headerlink" href="#visualisations" title="Link to this heading">¶</a></h1>
<p>Advanced users will want to make their own visualisations and further analyses.</p>
<section id="loading-the-model">
<h2>Loading the model<a class="headerlink" href="#loading-the-model" title="Link to this heading">¶</a></h2>
<p>To start, lets pick one possible posterior sample:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">posterior_sample</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>This will be the parameter values for each parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">paramname</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">paramnames</span><span class="p">,</span> <span class="n">posterior_sample</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">paramname</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we load the corresponding model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># for sherpa:</span>
<span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">posterior_sample</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">v</span>

<span class="c1"># for xspec:</span>
<span class="kn">from</span> <span class="nn">bxa.xspec</span> <span class="kn">import</span> <span class="n">set_parameters</span>
<span class="n">set_parameters</span><span class="p">(</span><span class="n">transformations</span><span class="o">=</span><span class="n">solver</span><span class="o">.</span><span class="n">transformations</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">posterior_sample</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="getting-the-data-for-plotting">
<h2>Getting the data for plotting<a class="headerlink" href="#getting-the-data-for-plotting" title="Link to this heading">¶</a></h2>
<p>Now, you should use xspec or sherpa’s capabilities to make a plot,
and extract the data.</p>
<p>For xspec, here are the references:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xanadu/xspec/python/html/quick.html#plotting">https://heasarc.gsfc.nasa.gov/docs/xanadu/xspec/python/html/quick.html#plotting</a></dt><dd><ul>
<li><p>see in particular the last example on that page!</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xanadu/xspec/python/html/plotmanager.html#plotmanager-label">https://heasarc.gsfc.nasa.gov/docs/xanadu/xspec/python/html/plotmanager.html#plotmanager-label</a></p></li>
<li><p><a class="reference external" href="https://heasarc.gsfc.nasa.gov/docs/xanadu/xspec/python/html/extended.html#plotting">https://heasarc.gsfc.nasa.gov/docs/xanadu/xspec/python/html/extended.html#plotting</a></p></li>
</ul>
</div></blockquote>
<p>For sherpa, you probably want to use the <a class="reference external" href="https://asc.harvard.edu/sherpa/ahelp/get_model_plot.html">get_model_plot</a>
(see also get_data_plot, get_source_plot, get_source_component_plot) to obtain the data to plot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">get_fit_plot</span><span class="p">()</span>
<span class="n">y_model</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">modelplot</span><span class="o">.</span><span class="n">y</span>
<span class="n">x_model</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">modelplot</span><span class="o">.</span><span class="n">x</span>
<span class="n">x_data</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">dataplot</span><span class="o">.</span><span class="n">x</span>
<span class="n">y_data</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">dataplot</span><span class="o">.</span><span class="n">y</span>
<span class="n">yerr_data</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">dataplot</span><span class="o">.</span><span class="n">yerr</span>
</pre></div>
</div>
<p>It may also be helpful to rebin the data prior to plotting.</p>
</section>
<section id="modifying-the-model">
<h2>Modifying the model<a class="headerlink" href="#modifying-the-model" title="Link to this heading">¶</a></h2>
<p>At this stage you could also extract information from a modified model.</p>
<p>For example, you could set the absorption to zero to plot the unabsorbed case,
or remove nuisance components to reveal the key component of interest.</p>
</section>
<section id="getting-the-entire-posterior">
<h2>Getting the entire posterior<a class="headerlink" href="#getting-the-entire-posterior" title="Link to this heading">¶</a></h2>
<p>In the sections above, we have worked with one posterior sample, and
obtained one model prediction.</p>
<p>For the Bayesian analysis, we have a posterior probability distribution of
the parameters, so we also want a posterior distribution of our model plot.</p>
<p>The pattern to follow is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">posterior_sample</span> <span class="ow">in</span> <span class="n">solver</span><span class="o">.</span><span class="n">posterior</span><span class="p">:</span>

        <span class="c1"># load model (see above)</span>
        <span class="o">...</span>

        <span class="c1"># get plot data (see above)</span>
        <span class="o">...</span>

        <span class="c1"># save plot data from this realisation:</span>
        <span class="n">prediction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="o">...</span> <span class="p">)</span>
</pre></div>
</div>
<p>Here, <cite>solver.posterior</cite> contains the equally weighted posterior samples (typically a few thousand).
You can also limit yourself to a few hundred with <cite>solver.posterior[:400]</cite>.</p>
</section>
<section id="plotting-the-prediction-band">
<h2>Plotting the prediction band<a class="headerlink" href="#plotting-the-prediction-band" title="Link to this heading">¶</a></h2>
<p>Finally, we want to plot the predictions.</p>
<p>This could be done inside the same script. Alternatively, you can write out the data
to a text file and write a separate, dedicated plotting script that reads the data.
This will allow you to quickly make changes to plots.</p>
<p>A helpful visualisation function to make credible interval bands is
<a class="reference external" href="https://johannesbuchner.github.io/UltraNest/ultranest.html#ultranest.plot.PredictionBand">PredictionBand</a>.</p>
<p>Putting it all together, here is one example for xspec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xspec</span> <span class="kn">import</span> <span class="n">Plot</span>
<span class="kn">from</span> <span class="nn">bxa.xspec.solver</span> <span class="kn">import</span> <span class="n">set_parameters</span><span class="p">,</span> <span class="n">XSilence</span>

<span class="n">band</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">Plot</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">with</span> <span class="n">XSilence</span><span class="p">():</span>
        <span class="n">Plot</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;/null&#39;</span>
        <span class="c1"># plot models</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">solver</span><span class="o">.</span><span class="n">posterior</span><span class="p">[:</span><span class="mi">400</span><span class="p">]:</span>
                <span class="n">set_parameters</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">transformations</span><span class="o">=</span><span class="n">solver</span><span class="o">.</span><span class="n">transformations</span><span class="p">)</span>
                <span class="n">Plot</span><span class="p">(</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">band</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">band</span> <span class="o">=</span> <span class="n">PredictionBand</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">x</span><span class="p">())</span>
                <span class="n">band</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">model</span><span class="p">())</span>

<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.495</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">band</span><span class="o">.</span><span class="n">line</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">Plot</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id1">
<img alt="_images/simplest-convolved_posterior_direct.png" src="_images/simplest-convolved_posterior_direct.png" />
<figcaption>
<p><span class="caption-text">Example of the convolved model spectrum prediction band.</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>For an example of extracting plot data for sherpa, see the <a class="reference internal" href="xagnfitter.html"><span class="doc">xagnfitter script</span></a> (towards the bottom).</p>
</section>
<section id="fluxes-and-luminosities">
<h2>Fluxes and luminosities<a class="headerlink" href="#fluxes-and-luminosities" title="Link to this heading">¶</a></h2>
<p>Similar to extracting plots, you can also compute a flux or luminosity
for each posterior sample, to obtain the entire posterior distribution.</p>
<figure class="align-default" id="id2">
<img alt="_images/simplest-flux_posterior.png" src="_images/simplest-flux_posterior.png" />
<figcaption>
<p><span class="caption-text">Posterior distribution of the soft and hard band fluxes.
Photon fluxes are shown in the left panel, energy fluxes in the right panel.
Histograms were obtained by taking each posterior sample, loading the model,
then computing the flux.</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>On this page you learned the ingredients to load up model realisations, extract data and
plot the results. Now you can make your visualisation the way you want it.</p>
<p>Visualisation contributions to BXA are welcome.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">BXA (Bayesian X-ray Analysis)</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sherpa-analysis.html">Sherpa with BXA</a></li>
<li class="toctree-l1"><a class="reference internal" href="xspec-analysis.html">Xspec with BXA</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learn more</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Visualisations</a></li>
<li class="toctree-l1"><a class="reference internal" href="engine.html">Inference engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="convenience.html">Convenience features</a></li>
<li class="toctree-l1"><a class="reference internal" href="background-models.html">Empirical background models</a></li>
<li class="toctree-l1"><a class="reference internal" href="pca-background-models.html">PCA-based background models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="xagnfitter.html">Obscured Active Galactic Nuclei</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_usage_plotbxa.html">PlotBXA example</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_usage_plotxspec.html">PlotXspec example</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="bxa.xspec.html" title="previous chapter">bxa.xspec package</a></li>
      <li>Next: <a href="engine.html" title="next chapter">Inference engine</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2013-2025, Johannes Buchner.
      
      |
      <a href="_sources/visualisations.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>