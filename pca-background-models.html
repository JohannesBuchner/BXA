
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PCA-based background models &#8212; BXA (Bayesian X-ray Analysis) 4.1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example scripts" href="examples.html" />
    <link rel="prev" title="Empirical background models" href="background-models.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
    <link rel="canonical" href="https://johannesbuchner.github.io/BXA/pca-background-models.html"/>
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pca-based-background-models">
<h1>PCA-based background models<a class="headerlink" href="#pca-based-background-models" title="Permalink to this heading">¶</a></h1>
<p>The advantages of using background spectral models is that more information
can be extracted from low-count data, as correlations between bins and instrument behaviours are known.</p>
<p>This page describes the machine-learning approach to derive empirical background models
published in <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2018A%26A...618A..66S/abstract">Simmonds et al., 2018, A&amp;A, 618A, 66</a>.
For Chandra/ACIS, XMM/EPIC, Swift/XRT, NuSTAR/FPMA, RXTE,
Large archives of background spectra were used to derive principal components (PCA)
that empirically describe the background and its variations.</p>
<p>BXA includes these PCA models, which can be fitted to a specific background spectrum.</p>
<p>These PCA models are trained in log10(counts + 1) space to avoid negative counts.
The PCA models operate on detector channels and thus should never pass through the response.</p>
<p>The PCA models are limited in how well they can describe additive components such as
gaussian emission lines. For this reason, the fitters also try adding Gaussian lines at
the location of strongest fit mismatch.</p>
<p>The fits keep increasing complexity (first, the number of PCA components and then, the gaussians) as long as the AIC (Akaike information criterion) improves.</p>
<section id="in-sherpa">
<h2>In Sherpa<a class="headerlink" href="#in-sherpa" title="Permalink to this heading">¶</a></h2>
<p>After setting your source model (with set_model), use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bxa.sherpa.background.pca</span> <span class="kn">import</span> <span class="n">auto_background</span>
<span class="n">convmodel</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="n">bkg_model</span> <span class="o">=</span> <span class="n">auto_background</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="n">set_full_model</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">get_response</span><span class="p">(</span><span class="nb">id</span><span class="p">)(</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span> <span class="n">bkg_model</span> <span class="o">*</span> <span class="n">get_bkg_scale</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
</pre></div>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="bxa.sherpa.background.pca.auto_background">
<span class="sig-prename descclassname"><span class="pre">bxa.sherpa.background.pca.</span></span><span class="sig-name descname"><span class="pre">auto_background</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bxa/sherpa/background/pca.html#auto_background"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#bxa.sherpa.background.pca.auto_background" title="Permalink to this definition">¶</a></dt>
<dd><p>Automatically fits background <em>id</em> based on PCA-based templates,
and additional gaussian lines as needed by AIC.</p>
</dd></dl>

<p>Beware that you need to set your energy limits and plot preferences
after using <cite>auto_background</cite> (it switches count / count rate units).</p>
<p>A full example for fitting obscured Active Galactic Nuclei is available:
<a class="reference external" href="https://github.com/JohannesBuchner/BXA/blob/master/examples/sherpa/xagnfitter.py">https://github.com/JohannesBuchner/BXA/blob/master/examples/sherpa/xagnfitter.py</a></p>
</section>
<section id="in-xspec">
<h2>In Xspec<a class="headerlink" href="#in-xspec" title="Permalink to this heading">¶</a></h2>
<p>In xspec, there are two steps.</p>
<p>First, fit the background spectrum outside xspec using the autobackgroundmodel/fitbkg.py script.</p>
<p>You can find it here: <a class="reference external" href="https://github.com/JohannesBuchner/BXA/tree/master/autobackgroundmodel">https://github.com/JohannesBuchner/BXA/tree/master/autobackgroundmodel</a></p>
<p>It will give you instructions how to load the PCA model in xspec.</p>
</section>
<section id="creating-a-new-pca-model">
<h2>Creating a new PCA model<a class="headerlink" href="#creating-a-new-pca-model" title="Permalink to this heading">¶</a></h2>
<p>See <a class="reference external" href="https://github.com/JohannesBuchner/BXA/tree/master/autobackgroundmodel#create-a-model">https://github.com/JohannesBuchner/BXA/tree/master/autobackgroundmodel#create-a-model</a></p>
</section>
<section id="if-the-fit-is-bad">
<h2>If the fit is bad<a class="headerlink" href="#if-the-fit-is-bad" title="Permalink to this heading">¶</a></h2>
<p>This should be judged from the q-q plot that the background fitting produces.</p>
<p>If it is off, it shows at what energies the problem is.</p>
<p>It may be that your spectrum is somehow different than typical spectra.</p>
<p>You can try another method (e.g., empirical background models, or fall back to Wstat statistics).</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">BXA (Bayesian X-ray Analysis)</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="sherpa-analysis.html">Sherpa with BXA</a></li>
<li class="toctree-l1"><a class="reference internal" href="xspec-analysis.html">Xspec with BXA</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learn more</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="visualisations.html">Visualisations</a></li>
<li class="toctree-l1"><a class="reference internal" href="engine.html">Inference engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="convenience.html">Convenience features</a></li>
<li class="toctree-l1"><a class="reference internal" href="background-models.html">Empirical background models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PCA-based background models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="xagnfitter.html">Obscured Active Galactic Nuclei</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="background-models.html" title="previous chapter">Empirical background models</a></li>
      <li>Next: <a href="examples.html" title="next chapter">Example scripts</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2013-2022, Johannes Buchner.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/pca-background-models.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>